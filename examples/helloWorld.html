<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<title>AMQP JS - Advanced Message Queue Protocol Javascript Client Implementaiton - Stocks</title>
	<script src="../javascripts/amqp.js" type="text/javascript"></script>
	<script src="../javascripts/swfobject.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	function directCallback(m) {
		alert("Direct Callback");
	};

	function exchangeCallback(message) {
		alert(message.data.message); //hello world!
	};
	
	function helloWorld() {
		myExchange.publish("keyTest", { message: "hello world!" });
	};

	var myQueue;
	var myExchange;

	//Initialize the proxy
	AMQPClient.initialize({
		connection: {
			host: "amqp.peermessaging.com"
		},
		logLevel    : 2,
		swfPath		: "../swfs/AMQPFlash.swf",
		expressPath	: "../swfs/expressInstall.swf"
	});


	AMQPClient.addListener("ready", function() {

		//Declare a queue and subscribe to it.
		//The callback is called when messages
		//are delivered to the queue.
		myQueue = new MessageQueue({
			callback: directCallback
		});

		//Declare an exchange for publishing messages
		//and binding
		myExchange = new Exchange({
			declare: {
				exchange: "ubertopic",
				type: "topic"
			}
		});

		//when the queue is declared, bind the exchange to it, so that
		//messages published to the exchange are delivered to the queue
		//and the javascript callback is called
		myQueue.addListener("declared", function(queue) {
			queue.bind(myExchange, "keyTest", exchangeCallback);
		}, this);
	});
	</script>

</head>
<body>

<div id="amqp-wrap" style="position:absolute;z-index:10000;left:10;top: 10;">
	<div id="AMQPProxy">Loading AMQP Proxy</div>
</div>

<a href="#" onClick="helloWorld();">Hello World</a><br/>

<div id="logger">
</div>

</body>

</html>